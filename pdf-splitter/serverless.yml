service: pdf-splitter-service

frameworkVersion: '3'

provider:
  name: aws
  runtime: python3.11
  region: us-east-1
  timeout: 900  # 15 minutes (Lambda max)
  memorySize: 3008  # Near max for better performance
  architecture: x86_64

  iam:
    role:
      statements:
        - Effect: Allow
          Action:
            - s3:GetObject
            - s3:PutObject
            - s3:DeleteObject
            - s3:ListBucket
          Resource:
            - arn:aws:s3:::tomas-ccc-public/*
            - arn:aws:s3:::tomas-ccc-public

functions:
  processPdf:
    handler: lambda_handler.lambda_handler
    description: Intelligently splits multi-question PDFs into individual question files
    url:
      cors: true
    timeout: 900
    memorySize: 3008
    environment:
      FUNCTION_NAME: processPdf

plugins:
  - serverless-python-requirements

custom:
  pythonRequirements:
    dockerizePip: true
    layer: false
    zip: true
    slim: true
    strip: false
    dockerImage: public.ecr.aws/sam/build-python3.11:latest
    pythonBin: python3.11
